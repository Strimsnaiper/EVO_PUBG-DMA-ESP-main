I couldn't fix this source code, it's not just about the offsets.
